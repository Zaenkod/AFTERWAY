<%= render "shared/navbar" %>
<div class="container">
  <div class="row">
    <div class="col">
      <div class="card-policy">
      <h1>Bar details</h1>
        <% @event_bars.each do |event_bar| %>
        <div class="card-bar">
          <%= cl_image_tag event_bar.bar.photo.key, crop: :fit%>
          <div class="card-bar-infos">
            <div class="card-bar-infos-left">
              <h2><%= link_to "#{event_bar.bar.name}", event_bar_path(event_bar) %> </h3>
              <p><%= event_bar.bar.address%> </p>
              <p class ="mb-3"><%= event_bar.bar.price %> € </p>
              <p><%= event_bar.bar.category %></p>
            </div>
            <div class="card-bar-infos-right">
              <p> <%= event_bar.votes.count %></p>
              <%# On n'affiche le lien de vote uniquement si l'utilisateur n'a pas encore voté pour cet event bar: %>
              <%# la méthode "voted_for?" est définie dans le modèle participant %>
              <%# @participant est défini dans EventsController#show %>

                <% if @participant.voted_for?(event_bar) %>
                  <p class="">You have voted for this bar!</p>
                  <p><%= link_to "Cancel my vote",
                                  vote_path(event_bar.votes.find_by(participant: @participant)),
                                  class: "btn btn-small btn-success",
                                  data: {
                                    turbo_method: :delete # ici on dit à Turbo de lancer une requête en méthode POST plutôt qu'en GET
                                  } %></p>
                <% elsif @participant.votes.count < 3 %>
                  <%# l'ancien lien, qui sans paramètre est par défaut en methode http GET %>

                  <p><%= link_to "Vote for this bar", "#" %></p>
                  <%# Ici on crée un lien en méthode POST pour atteindre l'action VotesController#create %>
                  <div class="card-bar-infos-right-pouce">
                  <%= link_to(event_bar_votes_path(event_bar), data: {
                                        turbo_method: :post # ici on dit à Turbo de lancer une requête en méthode POST plutôt qu'en GET
                                      }) do %>
                    <i class="fa-solid fa-thumbs-up"></i>
                  <% end %>
                  </div>

                <% end %>

              <p><%= link_to "Book this bar", event_bar_path(event_bar) %></p>

            </div>
          </div>
        </div>
        <% end %>
      </div>
    </div>
  </div>
</div>
